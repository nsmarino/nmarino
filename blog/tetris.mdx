---
slug: 'tetris'
title: Tetris with p5.js
desc: 'An exercise in basic object-oriented game programming'
date: '4 Feb 2021'
wordCount: '983'
---
I used [p5js](https://p5js.org/) to create a simple Tetris clone and practice the basic concepts of [object oriented programming](https://www.freecodecamp.org/news/object-oriented-programming-concepts-21bb035f7260/). I first became aware of p5js from the Coding Train videos produced by [Dan Shiffman](https://shiffman.net/), who also wrote the excellent book [The Nature of Code](https://natureofcode.com/), which I would recommend to anyone interested in simulating natural systems or making art with code.

The completed game can be found [here](https://editor.p5js.org/nsmarino/sketches/6KxrcCVIp).

## Basic Setup
The p5js library is basically a set of utilities wrapped around the HTML5 Canvas. At its most straightforward, it consists of two functions: a setup() function that runs once on page load, and a draw() function that loops over and over until you tell it to stop.

After staring at a jpeg of a tetris game for a while, I figured I should start by setting up a grid for the pieces (which i will refer to as 'tetrominos' for this rest of this post) to move around on.

```javascript
// Sketch.js:
const tileCount = 10
let tileSize

function setup() { // This runs once
  createCanvas(200, 400);
  tileSize=width/tileCount 
  // each square of the grid will be 20px by 20px
}

function draw() { // This will loop
  background(50); 
}
```
## Creating the Tetrominos
I began by making a simple tetromino of a random shape that falls from the top of the screen and comes to rest at the bottom of the screen. I created a new file, 'Tetromino.js', and placed it in my index.html before the sketch.js file so that the sketch.js file has access to it.

There are [seven basic Tetromino shapes](https://tetris.fandom.com/wiki/Tetromino?file=Tetromino_image.png). We can represent them as JavaScript objects, each with a color and an array of strings that each depict a possible position the tetromino can be in.

I created a Tetromino [constructor function](https://javascript.info/constructor-new) for creating tetromino objects. Here we can define the properties that each tetromino has (such as shape, color, and position) and the actions it can take (such as rotating and moving). Once this function is written, we can use it in our sketch.js function to make tetrominos.

Because each tetromino is made of four blocks, I alse created a Block constructor function. The idea is that the Tetromino will serve as a 'manager' for the four blocks that it contains. Each action taken by the Tetromino will update the properties of the blocks that form it.

```javascript
// Tetromino.js:

const types = // ...Array of types info...
const randomType = () => types[Math.floor(random(types.length))]

function Tetromino(type=randomType()) {
  this.active = true
  this.type = type
  this.origin = {x: 0, y: 0}
  this.rotateStep = 0

  // get shape from type and create four blocks
  this.setBlocks = function(shape = type.shapes[0]) {
  const blocks = []
  let pos = {x: this.origin.x, y: this.origin.y}
  for (let i=0; i<shape.length; i++) {
    if (shape[i]===`x`) { // BLOCK
      blocks.push(new Block(pos.x,pos.y,this.type.color))
      pos.x = pos.x + tileSize
    } else if (shape[i]===`-`) { // LINEBREAK
        pos.y = pos.y + tileSize  
        pos.x = this.origin.x
    } else if (shape[i]===`.`) { // SPACE
      pos.x = pos.x + tileSize
    }  
  }
  return blocks
  
  }
  this.blocks = this.setBlocks()

  // call the display function of each
  // of the four blocks
  this.display = function() {
    for (const block of this.blocks) {
      block.display()
    }
  }
}

// Called four times by Tetromino function
function Block(x,y,color) {
  this.x = x
  this.y = y
  this.color = color
  
  this.display = function() {
    fill(this.color)
    square(this.x,this.y,tileSize)
  }
}

```
